using Aspose.Gis;
using Aspose.Gis.Rendering;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using System;
using System.Collections.Generic;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Threading.Tasks;

namespace GeoJsonToSvg.Controllers
{
    [ApiController]
    [Route("[controller]")]
    public class SvgController : ControllerBase
    {
        private readonly ILogger<SvgController> _logger;

        public SvgController(ILogger<SvgController> logger)
        {
            _logger = logger;
        }

        [HttpGet]
        public string Get(string geojson)
        {
            if (string.IsNullOrEmpty(geojson)) return "";

            using (var map = new Map(350, 350))
            {
                using (var streamIn = GetStream(geojson.Replace("\\\"", "\"")))
                {
                    var pathIn = AbstractPath.FromStream(streamIn);
                    var pathOut = AbstractPath.FromStream(new MemoryStream());

                    map.Add(VectorLayer.Open(pathIn, Drivers.GeoJson));
                    map.Render(pathOut, Renderers.Svg);

                    var streamOut = pathOut.Open(FileAccess.ReadWrite);
                    var reader = new StreamReader(streamOut);
                    return reader.ReadToEnd();
                }
            }
        }

        private static Stream GetStream(string s)
        {
            var stream = new MemoryStream();
            var writer = new StreamWriter(stream);
            writer.Write(s);
            writer.Flush();
            stream.Position = 0;
            return stream;
        }

        public static LandParcelGeometry Geometry7 => new LandParcelGeometry
        {
            //Color = new Color(255, 80, 70),
            GLine = "{\"type\": \"LineString\",\"coordinates\":[[577750,1153651],[578897,1155848]]}",
            GLand = "{\"type\": \"Polygon\",\"coordinates\":[[[578337.6431,1154695.2561000008],[578331.22910000011,1154685.1090999991],[578327.63009999972,1154679.4671],[578320.4781,1154667.3211000003],[578315.84509999957,1154660.3480999991],[578319.86309999973,1154655.9821000006],[578322.01609999966,1154655.1051000003],[578323.13709999993,1154654.3451000005],[578332.48110000044,1154664.5041000005],[578357.45210000034,1154643.1680999994],[578359.17109999992,1154645.5300999992],[578372.80310000014,1154660.2521000002],[578391.00310000032,1154677.2140999995],[578373.23110000044,1154710.7661000006],[578377.41509999987,1154719.9410999995],[578376.99710000027,1154727.3590999991],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008]]]}",
            GStreet = "{\"type\": \"Polygon\",\"coordinates\":[[[578268.17609999981,1154658.6411000006],[578284.49110000022,1154688.1330999993],[578290.55709999986,1154684.6930999998],[578296.59009999968,1154696.3871],[578300.74110000022,1154707.1800999995],[578301.25009999983,1154708.1090999991],[578306.91210000031,1154717.4750999995],[578309.41810000036,1154721.6261],[578311.81410000008,1154726.4381000008],[578314.1941,1154727.8811000008],[578318.46810000017,1154736.5021000002],[578318.70110000018,1154740.4530999996],[578327.88109999988,1154758.0320999995],[578340.0390999997,1154783.1910999995],[578349.83915382286,1154802.9516915821],[578347.52510738722,1154804.0115842698],[578345.13249382819,1154804.961721892],[578342.6941477824,1154805.7874516931],[578340.21653316973,1154806.4865847095],[578337.70621800877,1154807.0572675781],[578336.64777540334,1154807.2411833098],[578333.24810000043,1154801.1210999992],[578326.90610000025,1154789.5281000007],[578313.94610000029,1154795.3150999993],[578304.04509999976,1154800.8050999995],[578302.87338307127,1154801.3279245656],[578300.70590592956,1154800.0024327028],[578299.5377078926,1154799.2026212055],[578302.3251,1154798.3341000006],[578310.5541000003,1154793.7710999995],[578325.87110000011,1154787.0271000005],[578322.9611,1154781.7451000009],[578320.99610000011,1154778.1521000005],[578315.33509999979,1154767.8380999994],[578311.85709999967,1154761.5760999992],[578310.0131000001,1154756.7451000009],[578310.08110000007,1154756.5241],[578307.29910000041,1154750.4331],[578303.40110000037,1154744.1680999994],[578304.16210000031,1154743.6981000006],[578301.94209999964,1154740.1191000007],[578299.98110000044,1154736.5971000008],[578297.17210000008,1154730.9041000009],[578297.99409999978,1154730.1971000005],[578288.63709999993,1154712.4390999991],[578281.41810000036,1154699.0440999996],[578277.81410000008,1154691.9400999993],[578274.8991,1154685.5481000002],[578271.95210000034,1154679.8950999994],[578269.23510000017,1154674.6741000004],[578267.04247454763,1154671.1211656504],[578266.40111678292,1154667.7839942737],[578265.96090323047,1154663.7491164203],[578265.86126750812,1154660.123420781],[578268.17609999981,1154658.6411000006]]]}",
            GStreet50 = "{\"type\": \"Polygon\",\"coordinates\":[[[578323.13709999993,1154654.3451000005],[578332.48110000044,1154664.5041000005],[578334.58927362761,1154662.7028108046],[578370.47212412779,1154731.4339551367],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008],[578331.22910000011,1154685.1090999991],[578327.63009999972,1154679.4671],[578320.4781,1154667.3211000003],[578315.84509999957,1154660.3480999991],[578319.86309999973,1154655.9821000006],[578322.01609999966,1154655.1051000003],[578323.13709999993,1154654.3451000005]]]}",
            GStreet100 = "{\"type\": \"Polygon\",\"coordinates\":[[[578357.45210000034,1154643.1680999994],[578359.17109999992,1154645.5300999992],[578372.80310000014,1154660.2521000002],[578391.00310000032,1154677.2140999995],[578373.23110000044,1154710.7661000006],[578377.41509999987,1154719.9410999995],[578376.99710000027,1154727.3590999991],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008],[578331.22910000011,1154685.1090999991],[578327.63009999972,1154679.4671],[578320.4781,1154667.3211000003],[578315.84509999957,1154660.3480999991],[578319.86309999973,1154655.9821000006],[578322.01609999966,1154655.1051000003],[578323.13709999993,1154654.3451000005],[578332.48110000044,1154664.5041000005],[578357.45210000034,1154643.1680999994]]]}",
            GStreet200 = "{\"type\": \"Polygon\",\"coordinates\":[[[578357.45210000034,1154643.1680999994],[578359.17109999992,1154645.5300999992],[578372.80310000014,1154660.2521000002],[578391.00310000032,1154677.2140999995],[578373.23110000044,1154710.7661000006],[578377.41509999987,1154719.9410999995],[578376.99710000027,1154727.3590999991],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008],[578331.22910000011,1154685.1090999991],[578327.63009999972,1154679.4671],[578320.4781,1154667.3211000003],[578315.84509999957,1154660.3480999991],[578319.86309999973,1154655.9821000006],[578322.01609999966,1154655.1051000003],[578323.13709999993,1154654.3451000005],[578332.48110000044,1154664.5041000005],[578357.45210000034,1154643.1680999994]]]}",
        };
        public static LandParcelGeometry Geometry16 => new LandParcelGeometry
        {
            //Color = new Color(255, 80, 70),
            GLine = "{\"type\": \"LineString\",\"coordinates\":[[577799,1155089],[578906,1154397]]}",
            GLand = "{\"type\": \"Polygon\",\"coordinates\":[[[578337.6431,1154695.2561000008],[578331.22910000011,1154685.1090999991],[578327.63009999972,1154679.4671],[578320.4781,1154667.3211000003],[578315.84509999957,1154660.3480999991],[578319.86309999973,1154655.9821000006],[578322.01609999966,1154655.1051000003],[578323.13709999993,1154654.3451000005],[578332.48110000044,1154664.5041000005],[578357.45210000034,1154643.1680999994],[578359.17109999992,1154645.5300999992],[578372.80310000014,1154660.2521000002],[578391.00310000032,1154677.2140999995],[578373.23110000044,1154710.7661000006],[578377.41509999987,1154719.9410999995],[578376.99710000027,1154727.3590999991],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008]]]}",
            GStreet = "{\"type\": \"Polygon\",\"coordinates\":[[[578268.17609999981,1154658.6411000006],[578284.49110000022,1154688.1330999993],[578290.55709999986,1154684.6930999998],[578296.59009999968,1154696.3871],[578300.74110000022,1154707.1800999995],[578301.25009999983,1154708.1090999991],[578306.91210000031,1154717.4750999995],[578309.41810000036,1154721.6261],[578311.81410000008,1154726.4381000008],[578314.1941,1154727.8811000008],[578318.46810000017,1154736.5021000002],[578318.70110000018,1154740.4530999996],[578327.88109999988,1154758.0320999995],[578340.0390999997,1154783.1910999995],[578349.83915382286,1154802.9516915821],[578347.52510738722,1154804.0115842698],[578345.13249382819,1154804.961721892],[578342.6941477824,1154805.7874516931],[578340.21653316973,1154806.4865847095],[578337.70621800877,1154807.0572675781],[578336.64777540334,1154807.2411833098],[578333.24810000043,1154801.1210999992],[578326.90610000025,1154789.5281000007],[578313.94610000029,1154795.3150999993],[578304.04509999976,1154800.8050999995],[578302.87338307127,1154801.3279245656],[578300.70590592956,1154800.0024327028],[578299.5377078926,1154799.2026212055],[578302.3251,1154798.3341000006],[578310.5541000003,1154793.7710999995],[578325.87110000011,1154787.0271000005],[578322.9611,1154781.7451000009],[578320.99610000011,1154778.1521000005],[578315.33509999979,1154767.8380999994],[578311.85709999967,1154761.5760999992],[578310.0131000001,1154756.7451000009],[578310.08110000007,1154756.5241],[578307.29910000041,1154750.4331],[578303.40110000037,1154744.1680999994],[578304.16210000031,1154743.6981000006],[578301.94209999964,1154740.1191000007],[578299.98110000044,1154736.5971000008],[578297.17210000008,1154730.9041000009],[578297.99409999978,1154730.1971000005],[578288.63709999993,1154712.4390999991],[578281.41810000036,1154699.0440999996],[578277.81410000008,1154691.9400999993],[578274.8991,1154685.5481000002],[578271.95210000034,1154679.8950999994],[578269.23510000017,1154674.6741000004],[578267.04247454763,1154671.1211656504],[578266.40111678292,1154667.7839942737],[578265.96090323047,1154663.7491164203],[578265.86126750812,1154660.123420781],[578268.17609999981,1154658.6411000006]]]}",
            GStreet50 = "{\"type\": \"Polygon\",\"coordinates\":[[[578379.92586659652,1154666.8903619235],[578391.00310000032,1154677.2140999995],[578373.23110000044,1154710.7661000006],[578377.41509999987,1154719.9410999995],[578376.99710000027,1154727.3590999991],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008],[578336.766739141,1154693.8696900166],[578379.92586659652,1154666.8903619235]]]}",
            GStreet100 = "{\"type\": \"Polygon\",\"coordinates\":[[[578357.45210000034,1154643.1680999994],[578359.17109999992,1154645.5300999992],[578372.80310000014,1154660.2521000002],[578391.00310000032,1154677.2140999995],[578373.23110000044,1154710.7661000006],[578377.41509999987,1154719.9410999995],[578376.99710000027,1154727.3590999991],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008],[578331.22910000011,1154685.1090999991],[578327.63009999972,1154679.4671],[578320.4781,1154667.3211000003],[578315.84509999957,1154660.3480999991],[578319.86309999973,1154655.9821000006],[578322.01609999966,1154655.1051000003],[578323.13709999993,1154654.3451000005],[578332.48110000044,1154664.5041000005],[578357.45210000034,1154643.1680999994]]]}",
            GStreet200 = "{\"type\": \"Polygon\",\"coordinates\":[[[578357.45210000034,1154643.1680999994],[578359.17109999992,1154645.5300999992],[578372.80310000014,1154660.2521000002],[578391.00310000032,1154677.2140999995],[578373.23110000044,1154710.7661000006],[578377.41509999987,1154719.9410999995],[578376.99710000027,1154727.3590999991],[578327.88109999988,1154758.0320999995],[578318.70110000018,1154740.4530999996],[578318.46810000017,1154736.5021000002],[578314.1941,1154727.8811000008],[578311.81410000008,1154726.4381000008],[578309.41810000036,1154721.6261],[578340.39609999955,1154699.9390999991],[578339.89809999987,1154698.8260999992],[578337.6431,1154695.2561000008],[578331.22910000011,1154685.1090999991],[578327.63009999972,1154679.4671],[578320.4781,1154667.3211000003],[578315.84509999957,1154660.3480999991],[578319.86309999973,1154655.9821000006],[578322.01609999966,1154655.1051000003],[578323.13709999993,1154654.3451000005],[578332.48110000044,1154664.5041000005],[578357.45210000034,1154643.1680999994]]]}",
        };
        public class LandParcelGeometry
        {
            public Color Color { get; set; }
            public string GLine { get; set; }
            public string GLand { get; set; }
            public string GStreet { get; set; }
            public string GStreet50 { get; set; }
            public string GStreet100 { get; set; }
            public string GStreet200 { get; set; }
        }
    }
}
